 # vim: filetype=sh

function prepare_import() {
  BASE=~/4-wailele/import-runs/`date -I`
  mkdir -p $BASE/{pre-dump,post-dump,pre-logs,logs,json}
  cd ~/wailele-production/
  find logs/ -size 0 -iname 'import*' -type f -delete
  find logs/ -iname 'import*' -or -iname 'message*' -type f -print0 | xargs -r0 mv -t $BASE/pre-logs/
  cp media/exports/*json $BASE/json/
  find $BASE/pre-logs/ $BASE/json/ -type f ! -iname '*gz' -print0 | xargs -r0 pigz -9
  cp `ls -d tools/sql/* | sort | tail -n1` $BASE/pre-dump/
}

function gutschrift_split()
{
  mkdir -p kundenkonto ueberweisung paypal
  pdfgrep Ã¼berweisen *pdf| cut -d':' -f1 | xargs -I% mv % ueberweisung/
  pdfgrep Kundenkonto *pdf| cut -d':' -f1 | xargs -I% mv % kundenkonto/
  pdfgrep 'Wir erst' *pdf| cut -d':' -f1 | xargs -I% mv % paypal/

  pdfunite *pdf sonstige_gutschriften.pdf
  pdfunite ueberweisung/*pdf ueberweisungen.pdf
  pdfunite kundenkonto/*pdf kundenkonto.pdf
  pdfunite paypal/*pdf paypal.pdf
}

function wailele_fetch()
{
  rsync wailele:gutschriften/REL*$1*2016*{$2..$3}* ./
}

alias wai='workon wailele && cd ~/wailele/'
alias kilenda='cd /srv/www/kilenda.de/'
alias mrs='./manage.py runserver'
alias msr='./manage.py runserver'
